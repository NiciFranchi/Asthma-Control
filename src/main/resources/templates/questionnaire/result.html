<!DOCTYPE html>
<html lang="en">
<head>
    <title>Questionnaire</title>
    <!--/*/ <th:block th:include="fragments/headerinc :: head"></th:block> /*/-->
</head>
<body>
<div class="container">
    <!--/*/ <th:block th:include="fragments/header :: header"></th:block> /*/-->

<div class="container">
    <div class = "container" id = "resultspage">
        <!-- HTML section for RESULTS page, which will eventually be moved to a new .jsp file
           hard coded for now, will adjust when API is availbale (returned calculated control levels + recomendation)
           as part of this, div id topText is left appearing for now -->
        <div class="py-2">
            <div class="container">
              <div class = "col-md-6">
                <div class="row unselectable">
                        <h2 id ="hImpairmentText" class="text-center">Impairment: </h2>
                </div>
                <div class="row unselectable">
                        <p class="text-center">Recommended Action for treatment <i><small> (editable) </small></i>:</p>
                </div>
                <!-- potential bug, what happens if you delete all text? data-emptytext doesnt seem to help-->
                <!-- Will pull in recommended action treatment from API here (remove hardcode, apppend to HTML)-->
                <div class="row">
                  <div class="panel panel-default" data-emptytext="Enter Action for treatment">
                    <ul id = "ulImpairmentActionTreatment" class="treatment_actionsZ" contenteditable="true">
                    </ul>
                  </div>
                </div>
              </div>
              <div class = "col-md-6">
                <div class="row unselectable">
                        <h2 id = "hRiskText" class="text-center">Risk: </h2>
                </div>
                <div class="row unselectable">
                        <p class="text-center">Recommended Action for treatment <i><small> (editable) </small></i>:</p>
                </div>
                <div class="row">
                    <div class="panel panel-default" data-emptytext="Enter Action for treatment">
                        <ul id = "ulRiskActionTreatment" class="treatment_actionsZ" contenteditable="true">
                        </ul>
                    </div>
                </div>
              </div>
            </div>
        </div>
    </div>
</div>
<!-- this hardcode will remain on Results page, static text from requirements -->
<div class="py-2">
    <div class="container unselectable">
        <div class="row">
            <div class="col-md-12">
                <p class=""><small>At present, there are inadequate data to correspond frequencies of exacerbations with different levels of asthma control. In general, more frequent and intense exacerbations (e.g. requiring urgent, unscheduled care, hospitalization, or ICU admission) indicate poorer disease control. For treatment purposes, patients who had >= 2 exacerbations requiring oral systemic corticosteroids in the past year may be considered the same as patients who have <b> not-well-controlled</b> asthma, even in the absence of impairment levels consistent with <b>not-well-controlled</b> asthma. </small></p>
            </div>
        </div>
    </div>
</div>
<!-- will save to FHIR using this button-->
<div class="text-center">
    <button id="btSubmitFHIR" class="btn btn-default">Save Action for Treatment</button>
</div>
    <script type="text/javascript">
        $(document).ready(function () {
            var urlParams = new URLSearchParams(location.search);
            var visitId = parseInt(urlParams.get('visitId'), 10);
            console.log("visitId: " + visitId);

            url = "/api/visits/" + visitId.toString();
            $.get(url, function () {
            }).done (function (data) {
                // update the control level and recommended actions for treatment for risk and impairment
                $.each(data.assessments, function (key, val) { 
                    if (val.domainOfControl == "Impairment")
                      {
                          document.getElementById("hImpairmentText").textContent += val.assessmentLevel;
                          $('#ulImpairmentActionTreatment').html(val.treatmentText);
                      }
                    else if (val.domainOfControl == "Risk")
                      {
                          document.getElementById("hRiskText").textContent += val.assessmentLevel;
                          $('#ulRiskActionTreatment').html(val.treatmentText);
                      }
                });
            });

           $("#btSubmitFHIR").click(function () {
                // show success toastr on json success
                toastr.success('Action plan submitted to FHIR');
           });

        });
        </script>
</div>
</body>
</html>
